function ChaZD(e,t,r,o){this.wordSource=r,this.useHttps=t;var a=getbasicurl(t,e),i=this,s=new XMLHttpRequest;s.open("GET",a,!0),s.onreadystatechange=function(){if(4==s.readyState){var a=JSON.parse(s.responseText);if(-1===e.indexOf("-")||i.checkErrorCode(a.errorCode).error||i.haveTranslation(a)){var n=i.parseResult.call(i,a);o(n)}else new ChaZD(e.replace(/-/g," "),t,r,o)}},s.send()}function getbasicurl(e,t){var r="",o=localStorage.getItem("chazduserkey"),a=localStorage.getItem("chazduserkeyfrom"),i=(new Date).getTime(),s="auto",n="auto",c=o+t+i+a,p=md5(c);return o&&""!==o&&a&&""!==a&&(r=e?fmt(templateUrls.dictHttps,t,s,n,o,i,p):fmt(templateUrls.dict,t,s,n,o,i,p)),r}function preprocessWord(e){return-1===e.indexOf(" ")&&(e=e.replace(/_/g," "),/[a-z]+/.test(e)&&(e=trim(e.replace(/([A-Z])/g," $1")))),e}function showNotification(e){if(Notifications){var t=null,r=Notifications.checkPermission();return 0===r?(t=Notifications.createNotification(e.icon||chrome.extension.getURL("icons/icon128.png"),e.title||"ChaZD 查字典",e.content),t.onclick=function(){window.open("https://chrome.google.com/webstore/detail/chazd/nkiipedegbhbjmajlhpegcpcaacbfggp")},t.show()):Notifications.requestPermission(),t}}ChaZD.prototype.checkErrorCode=function(e){var t={message:"",error:0,errorCode:0};switch(parseInt(e)){case 0:t.message="query success";break;case 103:t.message="要翻译的文本过长",t.error=1,t.errorCode=103;break;case 302:t.message="无法进行有效的翻译",t.error=1,t.errorCode=302;break;case 102:t.message="不支持的语言类型",t.error=1,t.errorCode=102;break;case 108:t.message="无效的key",t.error=1,t.errorCode=108;break;case 301:t.message="无辞典结果",t.error=1,t.errorCode=301}return t},ChaZD.prototype.parseResult=function(e){var t={},r=this.checkErrorCode(e.errorCode);if(t.haveWebTranslation=!1,r.error)t.errorCode=r.errorCode;else{var o=this.initTitle(e);if(t.titleBlock=o.titleBlock,t.haveTranslation=this.haveTranslation(e),void 0!==e.basic){var a=this.parseBasicResult(e);t.basicBlock=a}if(void 0!==e.web){var i=this.parseWebResult(e);t.haveWebTranslation=!0,t.webBlock=i}}return t.validMessage=r.message,t},ChaZD.prototype.haveTranslation=function(e){if(this.checkErrorCode(e.errorCode).error)return!1;var t=e.translation,r=e.query;return trim(r.toLowerCase())!==trim(t.toString().toLowerCase())},ChaZD.prototype.initTitle=function(e){var t=e.translation,r=e.query,o=this.initVoice(r);r=r.length>=50&&"select"==this.wordSource?this.shortWord(r):r;var a=fmt(frame.titleWord,r,o),i=fmt(frame.titleTranslation,t.toString());return{titleBlock:fmt(frame.titleContainer,a,i,r.length>=50?"long-text":"")}},ChaZD.prototype.shortWord=function(e){return e.slice(0,e.lastIndexOf(" ",50)).concat(" ...")},ChaZD.prototype.parseBasicResult=function(e){var t=e.basic,r=e.query,o=this.parseBasicPhonetic(t,r),a=this.parseBasicExplains(t,r),i=fmt(frame.basicContainer,o,a);return i},ChaZD.prototype.parseBasicPhonetic=function(e,t){var r=e["uk-phonetic"],o=e["us-phonetic"];if(void 0!==r&&void 0!==o){var a=this.initVoice(t,1),i=fmt(frame.ukPhoneticContainer,"["+r+"]"+a),s=this.initVoice(t,2),n=fmt(frame.usPhoneticContainer,"["+o+"]"+s);return fmt(frame.phoneticContainer,i,n)}return fmt(frame.phoneticContainer,"","")},ChaZD.prototype.initVoice=function(e,t){var r=(this.useHttps?templateUrls.voiceHttps:templateUrls.voice)+e;void 0!==t&&(r=r+"&type="+t);var o="";return o=1===t?"英音":2===t?"美音":"真人发音",fmt(frame.voiceContainer,r,o)},ChaZD.prototype.parseBasicExplains=function(e,t){var r,o=e.explains,a="";for(r=0;r<o.length;r++){var i=o[r],s=i.indexOf(". "),n=-1!==s?i.slice(0,s+1):"",c=this.parseProperty(n),p=fmt(frame.propertyContainer,c,n),l=-1!==s?i.slice(s+1):i,h=fmt(frame.explain,p,l);a+=h}return fmt(frame.explainsContainer,fmt(frame.explainsList,a))},ChaZD.prototype.parseProperty=function(e){var t="";switch(e){case"adj.":t="形容词";break;case"adv.":t="副词";break;case"n.":t="名词";break;case"vi.":t="不及物动词";break;case"vt.":t="及物动词";break;case"prep.":t="介词";break;case"conj.":t="连词";break;case"int.":t="感叹词";break;case"abbr.":t="代词";break;case"pron.":t=""}return t},ChaZD.prototype.parseWebResult=function(e){var t,r=e.web,o="";for(t=0;t<r.length;t++){var a=fmt(frame.webExplain,r[t].key,r[t].value);o+=a}return fmt(frame.webExplainsContainer,fmt(frame.webExplainsList,o))},window.Notifications=window.Notifications||window.webkitNotifications,chrome.runtime.onInstalled.addListener(function(e){"install"===e.reason?showNotification({title:"感谢支持 ChaZD ！",content:"ChaZD 力求成为最简洁易用的 Chrome 词典扩展，欢迎提出您的意见或建议。如果觉得 ChaZD 还不错，记得给5星好评哦:)"}):"update"===e.reason&&(chrome.storage.sync.set({showTips:!0},function(){}),showNotification({title:"ChaZD 更新到0.8.19版！",content:"修复若干 bug，如出现无法查词的问题，请在设置中关闭使用 HTTPS 接口"}))}),chrome.storage.sync.get(null,function(e){if(void 0===e.showTips)chrome.storage.sync.set(settings);else{for(var t in e)void 0===settings[t]?chrome.storage.sync.remove(t):settings[t]=e[t];chrome.storage.sync.set(settings)}}),chrome.runtime.onMessage.addListener(function(e,t,r){if(void 0!==e.type&&"voice"===e.type){var o=new Audio;o.src=e.src,o.play()}else new ChaZD(preprocessWord(e.queryWord),e.useHttps,e.source,r);return!0});